cmake_minimum_required(VERSION 2.8.9)

# Project details
enable_language (Fortran)
project (test)
set(exec_name "test")

add_definitions(-DPPIFORT)
set(compiler_name "ifort")
find_program(WHICH NAMES which)
exec_program(${WHICH} ARGS ${compiler_name} OUTPUT_VARIABLE compiler_path)
set(CMAKE_Fortran_COMPILER ${compiler_path})

# Library links

# Common include and link directories
include_directories(/usr/local/include)
link_directories(/usr/local/lib)
include_directories(/cm/shared/apps/Intel/fftw/3.3.4/include)
link_directories(/cm/shared/apps/Intel/fftw/3.3.4/lib
/cm/shared/apps/blas/3.2.1/lib /cm/shared/apps/Intel/lapack/3.3.0/lib)

link_libraries(fftw3 lapack blas)    


# List common sources
set (Sources test_wake_model.f90 types.f90 wake_model.f90 param.f90 util.f90 messages.f90 string_util.f90 open_file.f90 init_random_seed.f90 rh_control.f90 minimize.f90 functions.f90 grid.f90 sim_param.f90 lbfgsb.f linpack.f timer.f)

set (CMAKE_Fortran_FLAGS "-cpp -O2 -funroll-loops -no-wrap-margin -assume byterecl")

# main lesgo executable
add_executable(${exec_name} ${Sources})

